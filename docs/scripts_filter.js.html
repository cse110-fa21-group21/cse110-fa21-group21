<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/filter.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/filter.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Spoonacular } from "./api/spoonacular.js";
/**
 * Filter class used filter and choose which recipes to display based on user preference.
 * Includes: Dietary, Price, Time, Cuisine, Ingredients
 */
export class Filter {
   /**
  * Constructor sets up the filter
  */
  constructor(
  ) {
    this.#createCuisineSelection();
  }
  #spoonacular = new Spoonacular();
  /**
   * Upon being called all recipe cards are filtered. From then on,
   * upon any checkbox being clicked, we refilter the collecting again.
   * @param {int} Num number of recipes we want to show
   */
  filtering(Num) {
    //needed for filtering before new searches
    this.#goThroughElements(Num);

    const checkboxByDiet = document.querySelector("form[id=filter-by-diet]");
    checkboxByDiet.addEventListener("click", () => {
      // Could use this to add some more functionality to the all button.
      this.#goThroughElements(Num);
    });

    const checkboxByPrice = document.querySelector("form[id=filter-by-price]");
    checkboxByPrice.addEventListener("click", () => {
      this.#goThroughElements(Num);
    });

    const checkboxByTime = document.querySelector("form[id=filter-by-time]");
    checkboxByTime.addEventListener("click", () => {
      this.#goThroughElements(Num);
    });

    const selectByCuisine = document.querySelector("select[id=select-cuisine]");
    selectByCuisine.addEventListener("change", () => {
      this.#goThroughElements(Num);
    });

    const searchByIngredientsButton = document.querySelector(
      "button[id=search-ingredients-button]"
    );
    searchByIngredientsButton.addEventListener("click", () => {
      this.#goThroughElements(Num);
    });
  }

  /**
   * We iterate over the collection of recipe-cards and hide those that
   * do meet the various filters.
   * @param {int} Num number of recipes we want to show
   * @private
   */
  #goThroughElements(Num) {
    const recipeCards = 
      document.querySelector(".section-recipe-cards-wrapper");
    for(let i = 0; i &lt; Num; i++){
      let card = recipeCards.children[i];
      card.classList.add("shown");
      card.classList.remove("hidden");
      // Should be a dietary check too?
      this.#priceAllChecked();
      this.#timeAllChecked();
      if (this.#checkPriceChecked()) {
        this.#filterByPrice(card);
      }
      if (this.#checkTimeChecked()) {
        this.#filterByTime(card);
      }
      if (this.#checkDietaryChecked()) {
        this.#filterByDietary(card);
      }
      if (!this.#defaultCuisineCheck()) {
        this.#filterByCuisine(card);
      }
      if (!this.#emptyIngredientsSearchCheck()) {
        this.#filterByIngredients(card);
      }
    }
  }

  /**
   * We check whether or not this recipe card falls into a range
   * that we have requested not to see. If so, we hide it.
   * @param {recipeCard} recipeCard: Recipe Card that is displayed in site before filter
   * @private
   */
  #filterByDietary(recipeCard) {
    //parse recipe score
    const recipeDietary = this.#extractDietary(recipeCard);

    /**
     * determine in which range our element falls into, the ranges
     * by design must be mutually exclusive
     */
    const dairy_free_diet = recipeDietary["dairy-free"];
    const gluten_free_diet = recipeDietary["gluten-free"];
    const vegetarian_diet = recipeDietary["vegetarian"];
    const vegan_diet = recipeDietary["vegan"];

    /**
     * determine which ranges are being filtered for
     *  - true: we want to see items in this range
     *  - false: we do not want to see item in this range
     */
    const dairy_free_checked = document.querySelector(
      "input[id=dairy-free-diet]"
    ).checked;
    const gluten_free_checked = document.querySelector(
      "input[id=gluten-free-diet]"
    ).checked;
    const vegetarian_checked = document.querySelector(
      "input[id=vegetarian-diet]"
    ).checked;
    const vegan_checked = document.querySelector(
      "input[id=vegan-diet]"
    ).checked;

    /**
     * if an item falls into a range but we are not requesting to see
     * it then it should be hidden
     */
    if (dairy_free_checked &amp;&amp; !dairy_free_diet) {
      recipeCard.classList.add("hidden");
      recipeCard.classList.remove("shown");
    }

    if (gluten_free_checked &amp;&amp; !gluten_free_diet) {
      recipeCard.classList.add("hidden");
      recipeCard.classList.remove("shown");
    }

    if (vegetarian_checked &amp;&amp; !vegetarian_diet) {
      recipeCard.classList.add("hidden");
      recipeCard.classList.remove("shown");
    }

    if (vegan_checked &amp;&amp; !vegan_diet) {
      recipeCard.classList.add("hidden");
      recipeCard.classList.remove("shown");
    }
  }

  /**
   * We check whether or not this recipe card falls into a range
   * that we have requested not to see. If so, we hide it.
   * @param {recipeCard} recipeCard: Recipe Cards shown in site before this filter
   * @private
   */
  #filterByPrice(recipeCard) {
    // parse recipe price
    const recipePrice = this.#extractPrice(
      this.#spoonacular.getRecipePrice(recipeCard.json)
    );

    const ranges = [];
    const checks = [];
    /**
     * determine in which range our element falls into, the ranges
     * by design must be mutually exclusive
     */
    const first_price = recipePrice >= 50.0;
    const second_price = recipePrice >= 20.0 &amp;&amp; recipePrice &lt; 50.0;
    const third_price = recipePrice >= 10.0 &amp;&amp; recipePrice &lt; 20.0;
    const fourth_price = recipePrice >= 5.0 &amp;&amp; recipePrice &lt; 10.0;
    const fifth_price = recipePrice >= 0.0 &amp;&amp; recipePrice &lt; 5.0;

    ranges.push(first_price);
    ranges.push(second_price);
    ranges.push(third_price);
    ranges.push(fourth_price);
    ranges.push(fifth_price);

    /**
     * determine which ranges are being filtered for
     *  - true: we want to see items in this range
     *  - false: we do not want to see item in this range
     */
    const first_checked = document.querySelector(
      "input[id=first-price]"
    ).checked;
    const second_checked = document.querySelector(
      "input[id=second-price]"
    ).checked;
    const third_checked = document.querySelector(
      "input[id=third-price]"
    ).checked;
    const fourth_checked = document.querySelector(
      "input[id=fourth-price]"
    ).checked;
    const fifth_checked = document.querySelector(
      "input[id=fifth-price]"
    ).checked;

    checks.push(first_checked);
    checks.push(second_checked);
    checks.push(third_checked);
    checks.push(fourth_checked);
    checks.push(fifth_checked);

    /**
     * if an item falls into a range but we are not requesting to see
     * it then it should be hidden
     */
    this.#decider(recipeCard, ranges, checks);
  }

  /**
   * We check whether or not this recipe card falls into a range
   * that we have requested not to see. If so, we hide it.
   * @param {recipeCard} recipeCard
   * @private
   */
  #filterByTime(recipeCard) {
    // parse recipe cooking time
    const recipeTime = this.#extractCookingTime(
      this.#spoonacular.getRecipeCookingTime(recipeCard.json)
    );

    const ranges = [];
    const checks = [];
    /**
     * determine in which range our element falls into, the ranges
     * by design must be mutually exclusive
     */
    const first_time = recipeTime >= 60;
    const second_time = recipeTime >= 45 &amp;&amp; recipeTime &lt; 60;
    const third_time = recipeTime >= 30 &amp;&amp; recipeTime &lt; 45;
    const fourth_time = recipeTime >= 15 &amp;&amp; recipeTime &lt; 30;
    const fifth_time = recipeTime >= 0 &amp;&amp; recipeTime &lt; 15;

    ranges.push(first_time);
    ranges.push(second_time);
    ranges.push(third_time);
    ranges.push(fourth_time);
    ranges.push(fifth_time);

    /**
     * if an item falls into a range but we are not requesting to see
     * it then it should be hidden
     */
    const first_checked = document.querySelector(
      "input[id=first-time]"
    ).checked;
    const second_checked = document.querySelector(
      "input[id=second-time]"
    ).checked;
    const third_checked = document.querySelector(
      "input[id=third-time]"
    ).checked;
    const fourth_checked = document.querySelector(
      "input[id=fourth-time]"
    ).checked;
    const fifth_checked = document.querySelector(
      "input[id=fifth-time]"
    ).checked;

    checks.push(first_checked);
    checks.push(second_checked);
    checks.push(third_checked);
    checks.push(fourth_checked);
    checks.push(fifth_checked);
    /**
     * if an item falls into a range but we are not requesting to see
     * it then it should be hidden
     */
    this.#decider(recipeCard, ranges, checks);
  }

  /**
   * Drop down menu which has the cuisines that a user can select.
   * This method will filter the user's choice and display the recipes that
   * have that cuisine that the user chooses.
   * @param {recipeCard} recipeCard: Recipe Cards shown in site before this filter
   * @private
   */
  #filterByCuisine(recipeCard) {
    const cuisineValue = document.querySelector(
      "select[id=select-cuisine]"
    ).value;

    if (!this.#defaultCuisineCheck()) {
      let data = recipeCard.data;
      console.log(data);
      if (data) {
        let recipeCuisine = data["cuisines"];
        console.log(recipeCuisine);

        if (!recipeCuisine.includes(cuisineValue)) {
          recipeCard.classList.add("hidden");
          recipeCard.classList.remove("shown");
        }
      }
    }
  }

  /**
   * Search bar where the user types in the ingredient they want to filter by.
   * Searches the recipes to see if they include that specific ingredient, then
   * filters it to only show recipes with that ingredient.
   * @param {recipeCard} recipeCard: Recipe Cards shown in site before this filter
   * @private
   */
  #filterByIngredients(recipeCard) {
    const searchByIngredientsText = document.querySelector(
      "input[id=search-ingredients]"
    ).value;

    if (!this.#emptyIngredientsSearchCheck()) {
      let data = recipeCard.data;
      if (data) {
        let recipeIngredientsData = data["nutrition"]["ingredients"];
        let recipeIngredients = [];

        recipeIngredientsData.forEach((recipe) => {
          recipeIngredients.push(recipe["name"]);
        });
        
        //Check if any ingredients of recipe contain substring of input
        if (!recipeIngredients.some(a =>a.includes(searchByIngredientsText.toLocaleLowerCase()))) {
          recipeCard.classList.add("hidden");
          recipeCard.classList.remove("shown");
        }
      }
    }
  }

  /**
   * Ensures that no other filter within prices can be checked
   * when the 'all' filter is selected
   * @private
   */
  #priceAllChecked() {
    const all_checked = document.querySelector("input[id=all-price]").checked;
    // ensure no other checkbox within the same form can be checked if 'all' is checked
    if (all_checked) {
      document.querySelector("input[id=first-price]").checked = false;
      document.querySelector("input[id=second-price]").checked = false;
      document.querySelector("input[id=third-price]").checked = false;
      document.querySelector("input[id=fourth-price]").checked = false;
      document.querySelector("input[id=fifth-price]").checked = false;
    }
  }

  /**
   * Ensures that no other filter within times can be checked
   * when the 'all' filter is selected
   * @private
   */
  #timeAllChecked() {
    const all_checked = document.querySelector("input[id=all-time]").checked;
    if (all_checked) {
      document.querySelector("input[id=first-time").checked = false;
      document.querySelector("input[id=second-time]").checked = false;
      document.querySelector("input[id=third-time]").checked = false;
      document.querySelector("input[id=fourth-time]").checked = false;
      document.querySelector("input[id=fifth-time]").checked = false;
    }
  }

  /**
   * Checks if any filter is checked within dietary restrictions
   * @returns {boolean} true -- if at least one of the checkboxes is checked
   * @returns {boolean} false -- otherwise
   * @private
   */
  #checkDietaryChecked() {
    const first_checked = document.querySelector(
      "input[id=dairy-free-diet]"
    ).checked;
    const second_checked = document.querySelector(
      "input[id=gluten-free-diet]"
    ).checked;
    const third_checked = document.querySelector(
      "input[id=vegetarian-diet]"
    ).checked;
    const fourth_checked = document.querySelector(
      "input[id=vegan-diet]"
    ).checked;

    return first_checked || second_checked || third_checked || fourth_checked;
  }

  /**
   * Checks if any filter, excluding the 'all' filter, is checked within
   * prices
   * @returns {boolean} true -- if at least one of the checkboxes is checked
   * @returns {boolean} false -- otherwise
   * @private
   */
  #checkPriceChecked() {
    const first_checked = document.querySelector(
      "input[id=first-price]"
    ).checked;
    const second_checked = document.querySelector(
      "input[id=second-price]"
    ).checked;
    const third_checked = document.querySelector(
      "input[id=third-price]"
    ).checked;
    const fourth_checked = document.querySelector(
      "input[id=fourth-price]"
    ).checked;
    const fifth_checked = document.querySelector(
      "input[id=fifth-price]"
    ).checked;

    return (
      first_checked ||
      second_checked ||
      third_checked ||
      fourth_checked ||
      fifth_checked
    );
  }

  /**
   * Checks if any filter, excluding the 'all' filter, is checked within
   * prices
   * @returns {boolean} true -- if at least one of the checkboxes is checked
   * @returns {boolean} false -- otherwise
   * @private
   */
  #checkTimeChecked() {
    const first_checked = document.querySelector(
      "input[id=first-time]"
    ).checked;
    const second_checked = document.querySelector(
      "input[id=second-time]"
    ).checked;
    const third_checked = document.querySelector(
      "input[id=third-time]"
    ).checked;
    const fourth_checked = document.querySelector(
      "input[id=fourth-time]"
    ).checked;
    const fifth_checked = document.querySelector(
      "input[id=fifth-time]"
    ).checked;
    return (
      first_checked ||
      second_checked ||
      third_checked ||
      fourth_checked ||
      fifth_checked
    );
  }

  /***************************************************
           HELPER METHOD
    *************************************************/
  /**
   * Check to see which range the card falls into and if the coinciding check is false,
   * (a.k.a not requested) then we hide the card
   * @param {recipeCard} card  - the DOM in question
   * @param {boolean[]} ranges - only one element in the ranges is set to true by design,
   *                             (mutual exclusivity required)
   * @param {boolean[]} checks - reflective of the current selected checkboxes
   * @private
   */
  #decider(card, ranges, checks) {
    if (ranges.length != checks.length) {
      console.log(
        "error: length of ranges ${ranges} is not the same as ${checks}"
      );
      return;
    }

    ranges.forEach((range, index) => {
      /**
       * if an item falls into a range but we are not requesting to see
       * it then it should be hidden
       */
      if (range &amp;&amp; !checks[index]) {
        card.classList.add("hidden");
        card.classList.remove("shown");
      }
    });
  }

  /***************************************************
           HELPER METHODS -- PARSERS 
    *************************************************/
  /**
   * Parse the numerical score from the spoonacular.js
   * representation of a recipe score
   * @param {string} scoreString
   * @returns {Number} recipe spoonacular score
   * @private
   */
  #extractDietary(recipeCard) {
    const dietary = {};
    dietary["dairy-free"] =
      !recipeCard.shadowRoot.getElementById("dairy-free").hidden;
    dietary["gluten-free"] =
      !recipeCard.shadowRoot.getElementById("gluten-free").hidden;
    dietary["vegetarian"] =
      !recipeCard.shadowRoot.getElementById("vegetarian").hidden;
    dietary["vegan"] = !recipeCard.shadowRoot.getElementById("vegan").hidden;
    return dietary;
  }

  /**
   * Parse the numerical price from the spoonacular.js
   * representation of a recipe price
   * @param {string} priceString
   * @returns {Number} recipe spoonacular price
   * @private
   */
  #extractPrice(priceString) {
    let dollarIndex = priceString.indexOf("$");
    let value = priceString.substring(dollarIndex + 1);
    return Number(value);
  }

  /**
   * Parse the numerical cooking time from the spoonacular.js
   * representation of a recipe cooking time
   * @param {string} cookingString
   * @returns {number} recipe cooking time
   * @private
   */
  #extractCookingTime(cookingString) {
    let spaceIndex = cookingString.indexOf(" ");
    let value = cookingString.substring(spaceIndex + 1);
    return Number(value);
  }

  /***************************************************
           HELPER METHODS -- CUISINE &amp; INGREDIENTS 
    *************************************************/

  /**
   * Creates the cuisine selection list (HTML)
   * @private
   */
  #createCuisineSelection() {
    const cuisines = [
      "African",
      "American",
      "Asian",
      "British",
      "Cajun",
      "Caribbean",
      "Chinese",
      "Eastern European",
      "French",
      "German",
      "Greek",
      "Indian",
      "Irish",
      "Italian",
      "Japanese",
      "Jewish",
      "Korean",
      "Latin American",
      "Mediterranean",
      "Mexican",
      "Middle Eastern",
      "Nordic",
      "Southern",
      "Spanish",
      "Thai",
      "Vietnamese",
    ];

    const cuisineSelector = document.querySelector("select[id=select-cuisine]");
    let defaultOption = document.createElement("option");
    defaultOption.value = "default";
    defaultOption.innerHTML = "---Pick a Cuisine to Filter By---";
    cuisineSelector.add(defaultOption, null);

    cuisines.forEach((cuisine) => {
      let cuisineOption = document.createElement("option");
      cuisineOption.value = cuisine;
      cuisineOption.innerHTML = cuisine;
      cuisineSelector.add(cuisineOption, null);
    });
  }

  /**
   * Checks to see if the selection is on the default value so no other actions
   * will be taken
   * @returns {Boolean} Comparison between the selected cuisine and the default string
   * @private
   */
  #defaultCuisineCheck() {
    const cuisineValue = document.querySelector(
      "select[id=select-cuisine]"
    ).value;
    return cuisineValue === "default";
  }

  /**
   * Checks to see if the search bar for ingredients is empty, if it is
   * there's no point in performing any actions on it
   * @returns {Boolean} Comparison between the searched ingredient and the empty string
   * @private
   */
  #emptyIngredientsSearchCheck() {
    const searchByIngredientsText = document.querySelector(
      "input[id=search-ingredients]"
    ).value;

    return searchByIngredientsText === "";
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="featuredCard.html">featuredCard</a></li><li><a href="Filter.html">Filter</a></li><li><a href="recipeCard.html">recipeCard</a></li><li><a href="recipeViewer.html">recipeViewer</a></li><li><a href="Router.html">Router</a></li><li><a href="shoppingCard.html">shoppingCard</a></li><li><a href="Spoonacular.html">Spoonacular</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bindFavoriteList">bindFavoriteList</a></li><li><a href="global.html#bindFeaturedRecipeCards">bindFeaturedRecipeCards</a></li><li><a href="global.html#bindFeaturedRecipes">bindFeaturedRecipes</a></li><li><a href="global.html#bindFilterButton">bindFilterButton</a></li><li><a href="global.html#bindHomeButton">bindHomeButton</a></li><li><a href="global.html#bindHomeSearch">bindHomeSearch</a></li><li><a href="global.html#bindNavSearch">bindNavSearch</a></li><li><a href="global.html#bindRecipeCards">bindRecipeCards</a></li><li><a href="global.html#bindRecipeViewers">bindRecipeViewers</a></li><li><a href="global.html#bindSearch">bindSearch</a></li><li><a href="global.html#bindShoppingList">bindShoppingList</a></li><li><a href="global.html#bindState">bindState</a></li><li><a href="global.html#compareRecipeCards">compareRecipeCards</a></li><li><a href="global.html#fetchAPI">fetchAPI</a></li><li><a href="global.html#fetchRandomAPI">fetchRandomAPI</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#recipesID">recipesID</a></li><li><a href="global.html#removeFavoriteList">removeFavoriteList</a></li><li><a href="global.html#removeShoppingList">removeShoppingList</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#sortRecipeCards">sortRecipeCards</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Dec 08 2021 16:22:23 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
